<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.novocozy.mappers.OrderMapper">
	
	<resultMap type="com.novocozy.domain.OrderVO" id="OrderVO">
		<result column="order_num" property="order_num"/>
		<result column="users_id" property="users_id" />
		<result column="order_date" property="order_name" />
		<collection property="OrderDetailVO" resultMap="OrderDetailVO" />
		<collection property="ProductImgVO" resultMap="ProductImgVO"/>
	</resultMap>
	
	<resultMap type="com.novocozy.domain.OrderDetailVO" id="OrderDetailVO">
		<result column="order_detail_num" property="order_detail_num"/>
		<result column="order_num" property="order_num" />
		<result column="product_num" property="product_num" />
		<result column="product_name" property="product_name" />
		<result column="product_count" property="product_count" />
		<result column="product_price" property="product_price" />
		<result column="refund_yn" property="refund_yn" />
	</resultMap>
	
	<resultMap type="com.novocozy.domain.ProductImgVO" id="ProductImgVO">
		<result column="img_num" property="img_num" />
		<result column="product_num" property="product_num" />
		<result column="img_url" property="img_url" />
	</resultMap>
	
	<insert id="insertOrder">
	INSERT INTO orders(order_num,users_id,order_date,order_name,order_zonecode
	,order_address,order_addressdetail,order_phone,order_deliverymsg,order_buyer_name
	,order_buyer_phone,order_buyer_email) VALUES(#{order_num},#{users_id},sysdate,#{order_name},#{order_zonecode}
	,#{order_address},#{order_addressdetail},#{order_phone},#{order_deliverymsg},#{order_buyer_name}
	,#{order_buyer_phone},#{order_buyer_email})
	</insert>
	
	<insert id="insertOrderDetail">
	INSERT INTO orders_detail(order_detail_num,order_num,product_num,product_name,product_count,product_price,refund_yn) 
	VALUES((SELECT NVL(MAX(order_detail_num), 0) + 1 FROM orders_detail),#{order_num},#{product_num}
	,#{product_name},#{product_count},#{product_price},'N')
	</insert>
	
	<delete id="resetCart">
	DELETE FROM cart WHERE users_id = #{users_id}
	</delete>
	
	<select id="listOrder">
		
	</select>

</mapper>